<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Momentum: Smart Student Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
            },
          },
        },
      }
    </script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "date-fns": "https://esm.sh/date-fns@2.30.0",
        "date-fns/locale": "https://esm.sh/date-fns@2.30.0/locale",
        "recharts": "https://esm.sh/recharts@2.12.2?deps=react@18.2.0,react-dom@18.2.0",
        "clsx": "https://esm.sh/clsx@2.1.0",
        "firebase/app": "https://esm.sh/firebase@9.23.0/app",
        "firebase/auth": "https://esm.sh/firebase@9.23.0/auth",
        "firebase/firestore": "https://esm.sh/firebase@9.23.0/firestore"
      }
    }
    </script>
    <script type="module">
        import React, { useState, useEffect, useContext, createContext, useMemo, useCallback, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { format, parseISO, startOfMonth, endOfMonth, startOfWeek, endOfWeek, eachDayOfInterval, isSameMonth, isSameDay, addMonths, subMonths, isToday, addDays, subDays, getDay } from 'date-fns';
        import { ko } from 'date-fns/locale';
        import { PieChart, Pie, Cell, ResponsiveContainer, BarChart, Bar, XAxis, YAxis, Tooltip, Legend } from 'recharts';
        
        import { initializeApp } from 'firebase/app';
        // Auth와 Firestore 모듈을 먼저 임포트하여 컴포넌트 등록을 보장합니다.
        import 'firebase/auth';
        import 'firebase/firestore';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from 'firebase/auth';
        import { getFirestore, doc, getDoc, setDoc } from 'firebase/firestore';

        // START: firebase.js
        const firebaseConfig = {
          apiKey: "AIzaSyDXosRVrrG0IfGgTZVGcm2Oym5oqQZRpY0",
          authDomain: "smart-planner-66923.firebaseapp.com",
          projectId: "smart-planner-66923",
          storageBucket: "smart-planner-66923.firebasestorage.app",
          messagingSenderId: "537649933631",
          appId: "1:537649933631:web:78e09e78a0fcaa5fbe778a",
          measurementId: "G-T9260RQK1F"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();
        // END: firebase.js

        // START: context/AuthContext.tsx
        const AuthContext = createContext(null);

        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (user) => {
                    setUser(user);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const value = { user, loading };
            
            if (loading) {
                return React.createElement("div", { className: "min-h-screen flex items-center justify-center" }, 
                    React.createElement("p", {className: "text-lg font-semibold text-slate-600"}, "인증 정보를 확인하는 중...")
                );
            }

            return React.createElement(AuthContext.Provider, { value }, children);
        };

        const useAuth = () => {
            return useContext(AuthContext);
        };
        // END: context/AuthContext.tsx

        // START: types.ts
        const TaskStatus = {
            ToDo: 'ToDo',
            Done: 'Done',
            NotDone: 'NotDone',
            Migrated: 'Migrated'
        };
        // END: types.ts

        // START: constants.ts
        const INITIAL_SUBJECTS = [
           { id: '1', name: '국어', color: 'bg-red-200 text-red-800' },
           { id: '2', name: '영어', color: 'bg-blue-200 text-blue-800' },
           { id: '3', name: '수학', color: 'bg-purple-200 text-purple-800' },
           { id: '4', name: '사회', color: 'bg-yellow-200 text-yellow-800' },
           { id: '5', name: '과학', color: 'bg-green-200 text-green-800' },
           { id: '6', name: '기타', color: 'bg-gray-200 text-gray-800' },
        ];
        const DAYS_OF_WEEK = ['일', '월', '화', '수', '목', '금', '토'];
        const INITIAL_DATA = {
            subjects: INITIAL_SUBJECTS,
            tasks: [],
            events: [],
            dDay: { targetDate: '2026-11-19', title: '수능' },
            weeklyGoals: [
                { id: crypto.randomUUID(), text: '핸드폰 안 하기', completed: {} },
                { id: crypto.randomUUID(), text: '영양제 챙겨 먹기', completed: {} },
                { id: crypto.randomUUID(), text: '30분 달리기', completed: {} },
            ],
            motivationalQuotes: {},
            studyRecords: {},
        };
        // END: constants.ts

        // START: components/Icons.tsx
        const HomeIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" })));
        const ChartBarIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" })));
        const CogIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" }), React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15 12a3 3 0 11-6 0 3 3 0 016 0z" })));
        const PlusIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 4v16m8-8H4" })));
        const XMarkIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: "4", ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M6 18L18 6M6 6l12 12" })));
        const CheckIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: "4", ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M5 13l4 4L19 7" })));
        const ArrowRightIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: "4", ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M14 5l7 7m0 0l-7 7m7-7H3" })));
        const ArrowUturnLeftIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" })));
        const TrashIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" })));
        const CircleIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-2 w-2 shrink-0", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: "4", ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M21 12a9 9 0 11-18 0 9 9 0 0118 0z" })));
        const PencilIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" })));
        const ChevronLeftIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15 19l-7-7 7-7" })));
        const ChevronRightIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 5l7 7-7 7" })));
        const ClockIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-4 w-4", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2, ...props }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" })));
        const LogoutIcon = (props) => (React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill:"none", viewBox:"0 0 24 24", stroke:"currentColor", strokeWidth:2, ...props }, React.createElement("path", { strokeLinecap:"round", strokeLinejoin:"round", d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})));
        const GoogleIcon = () => (React.createElement("svg", {className:"w-5 h-5", role:"img", viewBox:"0 0 24 24", xmlns:"http://www.w3.org/2000/svg"}, React.createElement("title", null, "Google icon"), React.createElement("path", {fill:"#4285F4", d:"M21.543 10.495h-9.98v3.96h5.787c-.248 1.532-1.463 3.6-4.28 3.62-2.614 0-4.832-2.144-4.832-4.852s2.218-4.852 4.832-4.852c1.49 0 2.456.652 3.015 1.188l2.812-2.787C21.44 5.21 19.14.93 15.68.93c-4.43 0-8.13 3.67-8.13 8.16s3.7 8.16 8.13 8.16c4.63 0 7.82-3.22 7.82-7.95 0-.54-.04-1.07-.12-1.585z"})));
        // END: components/Icons.tsx

        // START: hooks/usePlannerData.ts
        const usePlannerData = () => {
            const { user } = useAuth();
            const [data, setData] = useState(INITIAL_DATA);
            const [isLoading, setIsLoading] = useState(true);
            const isInitialLoad = useRef(true);

            // Fetch data from Firestore
            useEffect(() => {
                if (!user) {
                    setIsLoading(false);
                    return;
                }

                const fetchData = async () => {
                    setIsLoading(true);
                    const userDocRef = doc(db, 'users', user.uid);
                    const docSnap = await getDoc(userDocRef);

                    if (docSnap.exists()) {
                        const firestoreData = docSnap.data();
                        // Simple migration check for old data structures if needed
                        if (!firestoreData.events) firestoreData.events = [];
                        if (!firestoreData.studyRecords) firestoreData.studyRecords = {};
                        setData(firestoreData);
                    } else {
                        // New user, set initial data in Firestore
                        await setDoc(userDocRef, INITIAL_DATA);
                        setData(INITIAL_DATA);
                    }
                    setIsLoading(false);
                    isInitialLoad.current = false;
                };

                fetchData();
            }, [user]);

            // Save data to Firestore whenever it changes
            useEffect(() => {
                if (!user || isInitialLoad.current || isLoading) {
                    return;
                }
                const userDocRef = doc(db, 'users', user.uid);
                setDoc(userDocRef, data);
            }, [data, user, isLoading]);
            
            const [selectedDate, setSelectedDate] = useState(null);

            const addTask = useCallback((task) => {
                const newTask = {
                    ...task,
                    id: crypto.randomUUID(),
                    status: TaskStatus.ToDo,
                };
                setData(prevData => ({ ...prevData, tasks: [...prevData.tasks, newTask] }));
            }, []);

            const updateTask = useCallback((taskId, updates) => {
                setData(prevData => ({
                    ...prevData,
                    tasks: prevData.tasks.map(task =>
                        task.id === taskId ? { ...task, ...updates } : task
                    ),
                }));
            }, []);

            const deleteTask = useCallback((taskId) => {
                setData(prevData => ({
                    ...prevData,
                    tasks: prevData.tasks.filter(task => task.id !== taskId),
                }));
            }, []);
            
            const addEvent = useCallback((event) => {
                const newEvent = {
                    ...event,
                    id: crypto.randomUUID(),
                    completed: false,
                };
                setData(prevData => ({ ...prevData, events: [...prevData.events, newEvent]}));
            }, []);

            const toggleEventCompletion = useCallback((eventId) => {
                setData(prevData => ({
                    ...prevData,
                    events: prevData.events.map(event =>
                        event.id === eventId ? { ...event, completed: !event.completed } : event
                    ),
                }));
            }, []);

            const deleteEvent = useCallback((eventId) => {
                setData(prevData => ({
                    ...prevData,
                    events: prevData.events.filter(event => event.id !== eventId),
                }));
            }, []);

            const addSubject = useCallback((subject) => {
                const newSubject = { ...subject, id: crypto.randomUUID() };
                setData(prevData => ({ ...prevData, subjects: [...prevData.subjects, newSubject] }));
            }, []);

            const deleteSubject = useCallback((subjectId) => {
                setData(prevData => ({
                    ...prevData,
                    subjects: prevData.subjects.filter(sub => sub.id !== subjectId)
                }));
            }, []);
            
            const updateDDay = useCallback((dDay) => {
                setData(prevData => ({ ...prevData, dDay }));
            }, []);
            
            const updateWeeklyGoals = useCallback((goals) => {
                setData(prevData => ({ ...prevData, weeklyGoals: goals }));
            }, []);
            
            const toggleWeeklyGoal = useCallback((goalId, date) => {
                setData(prevData => ({
                  ...prevData,
                  weeklyGoals: prevData.weeklyGoals.map(goal => {
                    if (goal.id === goalId) {
                      const newCompleted = { ...goal.completed };
                      newCompleted[date] = !newCompleted[date];
                      return { ...goal, completed: newCompleted };
                    }
                    return goal;
                  }),
                }));
            }, []);

            const updateWeeklyMotivationalQuote = useCallback((weekKey, quote) => {
                setData(prevData => {
                    const newQuotes = { ...prevData.motivationalQuotes, [weekKey]: quote };
                    return { ...prevData, motivationalQuotes: newQuotes };
                });
            }, []);

            const updateStudyTime = useCallback((date, timeInMinutes) => {
                setData(prevData => ({
                    ...prevData,
                    studyRecords: { ...prevData.studyRecords, [date]: timeInMinutes }
                }));
            }, []);

            const getStudyTimeForDate = useCallback((date) => {
                return data.studyRecords?.[date] || 0;
            }, [data.studyRecords]);

            const getSubjectById = useCallback((id) => {
                return data.subjects.find(sub => sub.id === id);
            }, [data.subjects]);

            const getTasksForDate = useCallback((date) => {
                return data.tasks.filter(task => task.date === date).sort((a,b) => a.id.localeCompare(b.id));
            }, [data.tasks]);
            
            const getEventsForDate = useCallback((date) => {
                return data.events.filter(event => event.date === date).sort((a,b) => a.id.localeCompare(b.id));
            }, [data.events]);

            return {
                ...data,
                isLoading,
                selectedDate,
                setSelectedDate,
                addTask,
                updateTask,
                deleteTask,
                addEvent,
                toggleEventCompletion,
                deleteEvent,
                getEventsForDate,
                addSubject,
                deleteSubject,
                updateDDay,
                updateWeeklyGoals,
                toggleWeeklyGoal,
                updateWeeklyMotivationalQuote,
                updateStudyTime,
                getStudyTimeForDate,
                getSubjectById,
                getTasksForDate,
            };
        };
        // END: hooks/usePlannerData.ts

        // START: context/PlannerContext.tsx
        const PlannerContext = createContext(null);

        const PlannerProvider = ({ children }) => {
            const plannerData = usePlannerData();
            return (
                React.createElement(PlannerContext.Provider, { value: plannerData }, 
                    plannerData.isLoading 
                    ? React.createElement("div", { className: "flex-grow flex items-center justify-center" }, 
                          React.createElement("p", {className: "text-lg font-semibold text-slate-600"}, "데이터를 불러오는 중...")
                      )
                    : children
                )
            );
        };
        // END: context/PlannerContext.tsx
        
        // START: components/TaskItem.tsx
        const StatusButton = ({ onClick, isActive, activeClass, label, icon }) => (
            React.createElement("button", {
                onClick: onClick,
                title: label,
                className: `p-2 rounded-full transition-colors duration-150 ${isActive ? activeClass : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`
            }, icon)
        );

        const TaskItem = ({ task }) => {
            const { getSubjectById, updateTask, deleteTask, subjects } = useContext(PlannerContext);
            const subject = getSubjectById(task.subjectId);

            const [isEditing, setIsEditing] = useState(false);
            const [editedPlan, setEditedPlan] = useState(task.plan);
            const [editedSubjectId, setEditedSubjectId] = useState(task.subjectId);

            const setStatus = (status) => {
                updateTask(task.id, { status });
            };

            const handleSave = () => {
                if (editedPlan.trim()) {
                    updateTask(task.id, { plan: editedPlan.trim(), subjectId: editedSubjectId });
                    setIsEditing(false);
                }
            };

            const handleCancel = () => {
                setEditedPlan(task.plan);
                setEditedSubjectId(task.subjectId);
                setIsEditing(false);
            };

            if (isEditing) {
                return (
                    React.createElement("div", { className: "bg-white p-3 rounded-lg shadow-sm flex flex-col gap-3 ring-2 ring-sky-500" },
                        React.createElement("input", {
                            type: "text",
                            value: editedPlan,
                            onChange: (e) => setEditedPlan(e.target.value),
                            className: "w-full px-3 py-2 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none text-slate-900 placeholder:text-slate-400",
                            autoFocus: true
                        }),
                        React.createElement("select", {
                            value: editedSubjectId,
                            onChange: (e) => setEditedSubjectId(e.target.value),
                            className: "w-full px-3 py-2 border border-slate-300 rounded-lg bg-white focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none text-slate-900"
                        },
                            subjects.map(sub => (
                                React.createElement("option", { key: sub.id, value: sub.id }, sub.name)
                            ))
                        ),
                        React.createElement("div", { className: "flex justify-end gap-2" },
                            React.createElement("button", { onClick: handleCancel, className: "px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 text-sm font-medium" }, "취소"),
                            React.createElement("button", { onClick: handleSave, className: "px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 text-sm font-medium" }, "저장")
                        )
                    )
                );
            }

            return (
                React.createElement("div", { className: "bg-white p-3 rounded-lg shadow-sm flex flex-col gap-2" },
                    React.createElement("div", { className: "flex justify-between items-start" },
                        React.createElement("p", { className: "text-slate-800 text-sm flex-1 mr-2" }, task.plan),
                        subject && React.createElement("span", { className: `px-2 py-0.5 text-xs font-semibold rounded-full ${subject.color}` }, subject.name)
                    ),
                    React.createElement("div", { className: "flex justify-between items-center" },
                        React.createElement("div", { className: "flex gap-1" },
                            React.createElement(StatusButton, { onClick: () => setStatus(TaskStatus.Done), isActive: task.status === TaskStatus.Done, activeClass: "bg-green-100 text-green-700", label: "완료", icon: React.createElement(CheckIcon, null) }),
                            React.createElement(StatusButton, { onClick: () => setStatus(TaskStatus.NotDone), isActive: task.status === TaskStatus.NotDone, activeClass: "bg-red-100 text-red-700", label: "미완료", icon: React.createElement(XMarkIcon, null) }),
                            React.createElement(StatusButton, { onClick: () => setStatus(TaskStatus.Migrated), isActive: task.status === TaskStatus.Migrated, activeClass: "bg-yellow-100 text-yellow-700", label: "미룸", icon: React.createElement(ArrowRightIcon, null) }),
                            task.status !== TaskStatus.ToDo && React.createElement(StatusButton, { onClick: () => setStatus(TaskStatus.ToDo), isActive: false, activeClass: "", label: "초기화", icon: React.createElement(ArrowUturnLeftIcon, null) })
                        ),
                        React.createElement("div", { className: "flex items-center" },
                            React.createElement("button", { onClick: () => setIsEditing(true), className: "p-2 rounded-full text-slate-400 hover:bg-slate-100 hover:text-slate-600", title: "수정" }, React.createElement(PencilIcon, null)),
                            React.createElement("button", { onClick: () => deleteTask(task.id), className: "p-2 rounded-full text-slate-400 hover:bg-red-100 hover:text-red-600", title: "삭제" }, React.createElement(TrashIcon, null))
                        )
                    )
                )
            );
        };
        // END: components/TaskItem.tsx

        // START: components/EventItem.tsx
        const EventItem = ({ event }) => {
            const { toggleEventCompletion, deleteEvent } = useContext(PlannerContext);
            return React.createElement("div", { className: "flex items-center justify-between bg-white p-3 rounded-lg shadow-sm" },
                React.createElement("div", { className: "flex items-center gap-3" },
                    React.createElement("input", {
                        type: "checkbox",
                        checked: event.completed,
                        onChange: () => toggleEventCompletion(event.id),
                        className: "h-5 w-5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 cursor-pointer"
                    }),
                    React.createElement("span", { className: `text-sm ${event.completed ? 'text-slate-500 line-through' : 'text-slate-800'}` }, event.text)
                ),
                React.createElement("button", { onClick: () => deleteEvent(event.id), className: "p-2 rounded-full text-slate-400 hover:bg-red-100 hover:text-red-600", title: "삭제" }, React.createElement(TrashIcon, null))
            );
        };
        // END: components/EventItem.tsx

        // START: components/DailyDetailView.tsx
        const DailyDetailView = ({ isOpen, onClose, date }) => {
            const { subjects, addTask, getTasksForDate, addEvent, getEventsForDate, updateStudyTime, getStudyTimeForDate } = useContext(PlannerContext);
            const [isAddingTask, setIsAddingTask] = useState(false);
            const [newPlan, setNewPlan] = useState('');
            const [selectedSubjectId, setSelectedSubjectId] = useState('');
            
            const [isAddingEvent, setIsAddingEvent] = useState(false);
            const [newEventText, setNewEventText] = useState('');

            const [studyHours, setStudyHours] = useState(0);
            const [studyMinutes, setStudyMinutes] = useState(0);

            const tasksForDate = date ? getTasksForDate(date) : [];
            const eventsForDate = date ? getEventsForDate(date) : [];

            useEffect(() => {
                if (subjects.length > 0) {
                    if (!selectedSubjectId || !subjects.find(s => s.id === selectedSubjectId)) {
                        setSelectedSubjectId(subjects[0].id);
                    }
                }
            }, [subjects, selectedSubjectId]);
            
            const handleAddTask = (closeAfter) => (e) => {
                e.preventDefault();
                if (date && newPlan.trim() && selectedSubjectId) {
                    addTask({ date, subjectId: selectedSubjectId, plan: newPlan.trim() });
                    setNewPlan('');
                    if (closeAfter) {
                        onClose();
                    } else {
                        const input = document.querySelector('input[name="new-plan"]');
                        input?.focus();
                    }
                }
            };

            const handleAddEvent = (closeAfter) => (e) => {
                e.preventDefault();
                if (date && newEventText.trim()) {
                    addEvent({ date, text: newEventText.trim() });
                    setNewEventText('');
                    if (closeAfter) {
                        onClose();
                    } else {
                        const input = document.querySelector('input[name="new-event"]');
                        input?.focus();
                    }
                }
            };

            const handleSaveStudyTime = () => {
                if (date) {
                    const totalMinutes = (studyHours * 60) + studyMinutes;
                    updateStudyTime(date, totalMinutes);
                    alert('순공시간이 저장되었습니다.');
                }
            };
            
            useEffect(() => {
                if (isOpen && date) {
                    const totalMinutes = getStudyTimeForDate(date) || 0;
                    setStudyHours(Math.floor(totalMinutes / 60));
                    setStudyMinutes(totalMinutes % 60);
                } else if (!isOpen) {
                    setIsAddingTask(false);
                    setNewPlan('');
                    setIsAddingEvent(false);
                    setNewEventText('');
                    setStudyHours(0);
                    setStudyMinutes(0);
                }
            }, [isOpen, date, getStudyTimeForDate]);

            if (!isOpen || !date) return null;

            const formattedDate = format(parseISO(date), 'MMMM d일, eeee', { locale: ko });

            return (
                React.createElement("div", { className: "fixed inset-0 bg-black/60 z-30 flex justify-end", onClick: onClose },
                    React.createElement("div", {
                        className: `w-full max-w-md h-full bg-slate-50 shadow-2xl flex flex-col transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : 'translate-x-full'}`,
                        onClick: e => e.stopPropagation(),
                    },
                        React.createElement("header", { className: "p-4 border-b border-slate-200 bg-white flex justify-between items-center sticky top-0" },
                            React.createElement("div", null,
                                React.createElement("h2", { className: "text-lg font-bold text-slate-800" }, formattedDate),
                                React.createElement("p", { className: "text-sm text-slate-500" }, "오늘의 할 일과 행사를 관리하세요")
                            ),
                            React.createElement("button", { onClick: onClose, className: "p-2 rounded-full hover:bg-slate-100" },
                                React.createElement(XMarkIcon, null)
                            )
                        ),
                        React.createElement("div", { className: "flex-grow p-4 overflow-y-auto space-y-4" },
                            React.createElement("div", null,
                                React.createElement("h3", { className: "font-semibold text-slate-700 mb-2" }, "오늘의 행사"),
                                React.createElement("div", { className: "space-y-2" },
                                    eventsForDate.length > 0 ? (
                                        eventsForDate.map(event => React.createElement(EventItem, { key: event.id, event: event }))
                                    ) : (
                                        !isAddingTask && !isAddingEvent && React.createElement("p", { className: "text-sm text-slate-400 text-center py-4" }, "예정된 행사가 없습니다.")
                                    )
                                )
                            ),
                            React.createElement("hr", { className: "my-4" }),
                            React.createElement("div", null,
                                React.createElement("h3", { className: "font-semibold text-slate-700 mb-2" }, "오늘의 할 일"),
                                React.createElement("div", { className: "space-y-2" },
                                    tasksForDate.length > 0 ? (
                                        tasksForDate.map(task => React.createElement(TaskItem, { key: task.id, task: task }))
                                    ) : (
                                        !isAddingTask && !isAddingEvent && React.createElement("p", { className: "text-sm text-slate-400 text-center py-4" }, "예정된 할 일이 없습니다.")
                                    )
                                )
                            )
                        ),
                        React.createElement("div", { className: "p-4 border-t border-slate-200 bg-white" },
                            React.createElement("div", { className: "pb-4 mb-4 border-b border-slate-200" },
                                React.createElement("h4", { className: "font-semibold text-sm text-slate-700 mb-2" }, "순공시간 기록"),
                                React.createElement("div", { className: "flex gap-2 items-center" },
                                    React.createElement("input", {
                                        type: "number",
                                        value: studyHours,
                                        onChange: (e) => setStudyHours(parseInt(e.target.value, 10) || 0),
                                        min: "0",
                                        className: "w-full text-center px-2 py-2 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-slate-900 placeholder:text-slate-400"
                                    }),
                                    React.createElement("span", { className: "font-semibold text-slate-600 shrink-0" }, "시간"),
                                    React.createElement("input", {
                                        type: "number",
                                        value: studyMinutes,
                                        onChange: (e) => setStudyMinutes(parseInt(e.target.value, 10) || 0),
                                        min: "0",
                                        max: "59",
                                        className: "w-full text-center px-2 py-2 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-slate-900 placeholder:text-slate-400"
                                    }),
                                    React.createElement("span", { className: "font-semibold text-slate-600 shrink-0" }, "분"),
                                    React.createElement("button", {
                                        onClick: handleSaveStudyTime,
                                        className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold shrink-0"
                                    }, "저장")
                                )
                            ),
                            isAddingTask ? (
                                React.createElement("form", { className: "space-y-3", onSubmit: handleAddTask(false) },
                                    React.createElement("input", {
                                        type: "text",
                                        name: "new-plan",
                                        value: newPlan,
                                        onChange: (e) => setNewPlan(e.target.value),
                                        placeholder: "새로운 할 일 내용을 입력하세요...",
                                        className: "w-full px-3 py-2 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none text-slate-900 placeholder:text-slate-400",
                                        autoFocus: true
                                    }),
                                    React.createElement("select", {
                                        value: selectedSubjectId,
                                        onChange: (e) => setSelectedSubjectId(e.target.value),
                                        className: "w-full px-3 py-2 border border-slate-300 rounded-lg bg-white focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none text-slate-900"
                                    },
                                        subjects.map(sub => (
                                            React.createElement("option", { key: sub.id, value: sub.id }, sub.name)
                                        ))
                                    ),
                                    React.createElement("div", { className: "flex justify-end gap-2" },
                                        React.createElement("button", { type: "button", onClick: () => setIsAddingTask(false), className: "px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 text-sm font-medium" }, "취소"),
                                        React.createElement("button", { type: "submit", className: "px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 text-sm font-medium" }, "추가"),
                                        React.createElement("button", { type: "button", onClick: handleAddTask(true), className: "px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 text-sm font-medium" }, "추가 후 닫기")
                                    )
                                )
                            ) : isAddingEvent ? (
                                React.createElement("form", { className: "space-y-3", onSubmit: handleAddEvent(false) },
                                    React.createElement("input", {
                                        type: "text",
                                        name: "new-event",
                                        value: newEventText,
                                        onChange: (e) => setNewEventText(e.target.value),
                                        placeholder: "새로운 행사 내용을 입력하세요...",
                                        className: "w-full px-3 py-2 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none text-slate-900 placeholder:text-slate-400",
                                        autoFocus: true
                                    }),
                                    React.createElement("div", { className: "flex justify-end gap-2" },
                                        React.createElement("button", { type: "button", onClick: () => setIsAddingEvent(false), className: "px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 text-sm font-medium" }, "취소"),
                                        React.createElement("button", { type: "submit", className: "px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 text-sm font-medium" }, "추가"),
                                        React.createElement("button", { type: "button", onClick: handleAddEvent(true), className: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-sm font-medium" }, "추가 후 닫기")
                                    )
                                )
                            ) : (
                                React.createElement("div", { className: "grid grid-cols-1 gap-3" },
                                    React.createElement("div", { className: "grid grid-cols-2 gap-3" },
                                        React.createElement("button", { onClick: () => setIsAddingEvent(true), className: "w-full flex items-center justify-center gap-2 py-3 bg-teal-600 text-white rounded-lg shadow-sm hover:bg-teal-700 transition-colors font-semibold" },
                                            React.createElement(PlusIcon, null),
                                            "행사 추가"
                                        ),
                                        React.createElement("button", { onClick: () => setIsAddingTask(true), className: "w-full flex items-center justify-center gap-2 py-3 bg-sky-600 text-white rounded-lg shadow-sm hover:bg-sky-700 transition-colors font-semibold" },
                                            React.createElement(PlusIcon, null),
                                            "할 일 추가"
                                        )
                                    ),
                                    React.createElement("button", { onClick: onClose, className: "w-full flex items-center justify-center gap-2 py-3 bg-slate-200 text-slate-800 rounded-lg shadow-sm hover:bg-slate-300 transition-colors font-semibold" },
                                        React.createElement(ChevronLeftIcon, { className: "h-5 w-5" }),
                                        "대시보드"
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };
        // END: components/DailyDetailView.tsx

        // START: components/SettingsView.tsx
        const Calendar = ({ selectedDate, onDateSelect }) => {
            const [currentMonth, setCurrentMonth] = useState(selectedDate || new Date());

            const monthStart = startOfMonth(currentMonth);
            const monthEnd = endOfMonth(currentMonth);
            const calendarStart = startOfWeek(monthStart);
            const calendarEnd = endOfWeek(monthEnd);

            const days = eachDayOfInterval({ start: calendarStart, end: calendarEnd });
            const dayNames = ['일', '월', '화', '수', '목', '금', '토'];

            return (
                React.createElement("div", { className: "bg-white p-3 rounded-lg shadow-lg border border-slate-200 w-72" },
                    React.createElement("div", { className: "flex justify-between items-center mb-2" },
                        React.createElement("button", { onClick: () => setCurrentMonth(subMonths(currentMonth, 1)), className: "p-2 rounded-full hover:bg-slate-100" },
                            React.createElement(ChevronLeftIcon, { className: "w-5 h-5" })
                        ),
                        React.createElement("span", { className: "font-semibold text-sm text-slate-700" },
                            format(currentMonth, 'yyyy년 MMMM', { locale: ko })
                        ),
                        React.createElement("button", { onClick: () => setCurrentMonth(addMonths(currentMonth, 1)), className: "p-2 rounded-full hover:bg-slate-100" },
                            React.createElement(ChevronRightIcon, { className: "w-5 h-5" })
                        )
                    ),
                    React.createElement("div", { className: "grid grid-cols-7 gap-y-1 text-center text-xs text-slate-500" },
                        dayNames.map(day => React.createElement("div", { key: day }, day))
                    ),
                    React.createElement("div", { className: "grid grid-cols-7 gap-y-1 mt-1" },
                        days.map(day => {
                            const isCurrentMonth = isSameMonth(day, currentMonth);
                            const isSelected = isSameDay(day, selectedDate);
                            const isTodaysDate = isToday(day);

                            return (
                                React.createElement("button", {
                                    key: day.toString(),
                                    onClick: () => onDateSelect(day),
                                    className: `
                                        w-9 h-9 mx-auto rounded-full text-sm flex items-center justify-center
                                        ${isCurrentMonth ? 'text-slate-700' : 'text-slate-300'}
                                        ${!isSelected && isTodaysDate ? 'bg-sky-100 text-sky-700' : ''}
                                        ${isSelected ? 'bg-sky-600 text-white font-bold' : ''}
                                        ${!isSelected ? 'hover:bg-slate-100' : ''}
                                        transition-colors duration-150
                                    `
                                }, format(day, 'd'))
                            );
                        })
                    )
                )
            );
        };

        const SettingsView = ({ goToDashboard }) => {
            const { dDay, updateDDay, weeklyGoals, updateWeeklyGoals, subjects, addSubject, deleteSubject } = useContext(PlannerContext);
            const [dDayTitle, setDDayTitle] = useState(dDay.title);
            const [dDayDate, setDDayDate] = useState(dDay.targetDate);
            const [isCalendarOpen, setIsCalendarOpen] = useState(false);

            const [localWeeklyGoals, setLocalWeeklyGoals] = useState(() => {
                const goals = JSON.parse(JSON.stringify(weeklyGoals || []));
                while (goals.length < 3) {
                    goals.push({ id: crypto.randomUUID(), text: '', completed: {} });
                }
                return goals.slice(0, 3);
            });
            
            const [newSubjectName, setNewSubjectName] = useState('');
            const [newSubjectColor, setNewSubjectColor] = useState('bg-gray-200 text-gray-800');

            const handleDDaySave = () => {
                updateDDay({ title: dDayTitle, targetDate: dDayDate });
                alert('디데이가 저장되었습니다!');
            };

            const handleWeeklyGoalsSave = () => {
                updateWeeklyGoals(localWeeklyGoals.filter(goal => goal.text.trim() !== ''));
                alert('주간 목표가 저장되었습니다!');
            };
            
            const handleGoalChange = (index, value) => {
                const newGoals = [...localWeeklyGoals];
                newGoals[index] = { ...newGoals[index], text: value };
                setLocalWeeklyGoals(newGoals);
            };

            const handleAddSubject = (e) => {
                e.preventDefault();
                if (newSubjectName.trim()) {
                    addSubject({ name: newSubjectName.trim(), color: newSubjectColor });
                    setNewSubjectName('');
                }
            };
            
            const colorOptions = [
                'bg-red-200 text-red-800', 'bg-orange-200 text-orange-800', 'bg-yellow-200 text-yellow-800',
                'bg-green-200 text-green-800', 'bg-teal-200 text-teal-800', 'bg-blue-200 text-blue-800',
                'bg-indigo-200 text-indigo-800', 'bg-purple-200 text-purple-800', 'bg-pink-200 text-pink-800',
                'bg-gray-200 text-gray-800',
            ];

            return (
                React.createElement("div", { className: "p-2" },
                    React.createElement("div", { className: "space-y-6" },
                        React.createElement("div", { className: "bg-white p-4 rounded-xl shadow-sm" },
                            React.createElement("h3", { className: "font-bold text-lg text-slate-800 mb-4" }, "디데이 설정 (D-Day)"),
                            React.createElement("div", { className: "space-y-3" },
                                React.createElement("div", null,
                                    React.createElement("label", { className: "block text-sm font-medium text-slate-600 mb-1" }, "제목"),
                                    React.createElement("input", { type: "text", value: dDayTitle, onChange: e => setDDayTitle(e.target.value), className: "w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 bg-white text-slate-900 placeholder:text-slate-400" })
                                ),
                                React.createElement("div", { className: "relative" },
                                    React.createElement("label", { className: "block text-sm font-medium text-slate-600 mb-1" }, "목표 날짜"),
                                    React.createElement("button", { type: "button", onClick: () => setIsCalendarOpen(!isCalendarOpen), className: "w-full text-left px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 bg-white text-slate-900" },
                                        dDayDate ? format(parseISO(dDayDate), 'yyyy년 M월 d일') : '날짜 선택'
                                    ),
                                    isCalendarOpen && (
                                        React.createElement("div", { className: "absolute top-full mt-1 left-0 z-10" },
                                            React.createElement(Calendar, {
                                                selectedDate: dDayDate ? parseISO(dDayDate) : new Date(),
                                                onDateSelect: date => {
                                                    setDDayDate(format(date, 'yyyy-MM-dd'));
                                                    setIsCalendarOpen(false);
                                                },
                                            })
                                        )
                                    )
                                ),
                                React.createElement("div", { className: "text-right" },
                                    React.createElement("button", { onClick: handleDDaySave, className: "px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 font-semibold" }, "디데이 저장")
                                )
                            )
                        ),
                        React.createElement("div", { className: "bg-white p-4 rounded-xl shadow-sm" },
                            React.createElement("h3", { className: "font-bold text-lg text-slate-800 mb-4" }, "주간 목표 설정(학습 이외의 활동)"),
                            React.createElement("div", { className: "space-y-3" },
                                Array.from({ length: 3 }).map((_, index) => (
                                    React.createElement("div", { key: index },
                                        React.createElement("label", { className: "block text-sm font-medium text-slate-600 mb-1" }, `목표 ${index + 1}`),
                                        React.createElement("input", {
                                            type: "text",
                                            value: localWeeklyGoals[index]?.text || '',
                                            onChange: e => handleGoalChange(index, e.target.value),
                                            className: "w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 bg-white text-slate-900 placeholder:text-slate-400",
                                            placeholder: `주간 목표 ${index + 1}을(를) 입력하세요`
                                        })
                                    )
                                )),
                                React.createElement("div", { className: "text-right" },
                                    React.createElement("button", { onClick: handleWeeklyGoalsSave, className: "px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 font-semibold" }, "주간 목표 저장")
                                )
                            )
                        ),
                        React.createElement("div", { className: "bg-white p-4 rounded-xl shadow-sm" },
                            React.createElement("h3", { className: "font-bold text-lg text-slate-800 mb-4" }, "과목 관리"),
                            React.createElement("div", { className: "space-y-2 mb-4" },
                                subjects.map(sub => (
                                    React.createElement("div", { key: sub.id, className: "flex items-center justify-between p-2 bg-slate-50 rounded-lg" },
                                        React.createElement("span", { className: `px-3 py-1 text-sm font-semibold rounded-full ${sub.color}` }, sub.name),
                                        React.createElement("button", { onClick: () => deleteSubject(sub.id), className: "p-2 rounded-full text-slate-400 hover:bg-red-100 hover:text-red-600" }, React.createElement(TrashIcon, null))
                                    )
                                ))
                            ),
                            React.createElement("form", { onSubmit: handleAddSubject, className: "p-3 bg-slate-100 rounded-lg space-y-3" },
                                React.createElement("h4", { className: "font-semibold text-slate-700" }, "새 과목 추가"),
                                React.createElement("input", {
                                    type: "text",
                                    value: newSubjectName,
                                    onChange: e => setNewSubjectName(e.target.value),
                                    placeholder: "과목명",
                                    className: "w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-sky-500 bg-white text-slate-900 placeholder:text-slate-400"
                                }),
                                React.createElement("div", { className: "flex flex-wrap gap-2" },
                                    colorOptions.map(color => (
                                        React.createElement("button", { type: "button", key: color, onClick: () => setNewSubjectColor(color), className: `w-8 h-8 rounded-full ${color.split(' ')[0]} border-2 ${newSubjectColor === color ? 'border-sky-500' : 'border-transparent'}` })
                                    ))
                                ),
                                React.createElement("div", { className: "text-right" },
                                    React.createElement("button", { type: "submit", className: "px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 font-semibold flex items-center gap-2" },
                                        React.createElement(PlusIcon, null), " 과목 추가"
                                    )
                                )
                            )
                        ),
                        React.createElement("div", { className: "mt-6" },
                            React.createElement("button", {
                                onClick: goToDashboard,
                                className: "w-full flex items-center justify-center gap-2 py-3 bg-slate-200 text-slate-800 rounded-lg shadow-sm hover:bg-slate-300 transition-colors font-semibold"
                            }, React.createElement(ChevronLeftIcon, { className: "h-5 w-5" }), "대시보드로 돌아가기")
                        )
                    )
                )
            );
        };
        // END: components/SettingsView.tsx
        
        // START: components/StatsView.tsx
        const RADIAN = Math.PI / 180;
        const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent, name }) => {
            const radius = innerRadius + (outerRadius - innerRadius) * 0.5;
            const x = cx + radius * Math.cos(-midAngle * RADIAN);
            const y = cy + radius * Math.sin(-midAngle * RADIAN);

            if (percent < 0.05) return null;

            return (
                React.createElement("text", { x: x, y: y, fill: "white", textAnchor: x > cx ? 'start' : 'end', dominantBaseline: "central", className: "text-xs font-semibold" },
                    `${name} (${(percent * 100).toFixed(0)}%)`
                )
            );
        };
        
        const StatsView = ({ goToDashboard }) => {
            const { tasks, getSubjectById } = useContext(PlannerContext);
            
            const thisWeekTasks = useMemo(() => {
                const today = new Date();
                const start = startOfWeek(today, { weekStartsOn: 1 });
                const end = endOfWeek(today, { weekStartsOn: 1 });
                const weekDates = eachDayOfInterval({start, end}).map(d => format(d, 'yyyy-MM-dd'));
                
                return tasks.filter(task => weekDates.includes(task.date));
            }, [tasks]);

            const subjectCompletionData = useMemo(() => {
                const subjectMap = new Map();
                const doneTasks = thisWeekTasks.filter(t => t.status === TaskStatus.Done);

                doneTasks.forEach(task => {
                    const subject = getSubjectById(task.subjectId);
                    if (subject) {
                        if (!subjectMap.has(subject.id)) {
                            subjectMap.set(subject.id, { name: subject.name, value: 0 });
                        }
                        subjectMap.get(subject.id).value += 1;
                    }
                });
                
                return Array.from(subjectMap.values()).filter(item => item.value > 0);
            }, [thisWeekTasks, getSubjectById]);
            
            const weeklyProgressData = useMemo(() => {
                const today = new Date();
                const start = startOfWeek(today, { weekStartsOn: 1 });
                const end = endOfWeek(today, { weekStartsOn: 1 });
                const weekDates = eachDayOfInterval({ start, end });

                return weekDates.map(date => {
                    const dateStr = format(date, 'yyyy-MM-dd');
                    const dayTasks = tasks.filter(t => t.date === dateStr);
                    const total = dayTasks.length;
                    const completed = dayTasks.filter(t => t.status === TaskStatus.Done).length;
                    
                    return {
                        name: format(date, 'E', { locale: ko }),
                        '완료된 할 일': completed,
                        '총 할 일': total,
                    };
                });
            }, [tasks]);


            const COLORS = ['#0ea5e9', '#10b981', '#f97316', '#eab308', '#8b5cf6', '#64748b'];

            return (
                 React.createElement("div", { className: "p-2" },
                    React.createElement("div", { className: "space-y-6" },
                        React.createElement("div", { className: "bg-white p-4 rounded-xl shadow-sm" },
                            React.createElement("h3", { className: "font-bold text-lg text-slate-800 mb-4" }, "이번 주 과목별 완료된 할 일"),
                            subjectCompletionData.length > 0 ? (
                                React.createElement(ResponsiveContainer, { width: "100%", height: 300 },
                                    React.createElement(PieChart, null,
                                        React.createElement(Pie, {
                                            data: subjectCompletionData,
                                            cx: "50%",
                                            cy: "50%",
                                            labelLine: false,
                                            label: renderCustomizedLabel,
                                            outerRadius: 120,
                                            fill: "#8884d8",
                                            dataKey: "value"
                                        },
                                            subjectCompletionData.map((entry, index) => (
                                                React.createElement(Cell, { key: `cell-${index}`, fill: COLORS[index % COLORS.length] })
                                            ))
                                        ),
                                        React.createElement(Tooltip, null)
                                    )
                                )
                            ) : (
                                React.createElement("p", { className: "text-center text-slate-500 py-10" }, "이번 주에 완료된 할 일이 없어 통계를 표시할 수 없습니다.")
                            )
                        ),
                        React.createElement("div", { className: "bg-white p-4 rounded-xl shadow-sm" },
                            React.createElement("h3", { className: "font-bold text-lg text-slate-800 mb-4" }, "주간 할 일 진행률"),
                            React.createElement(ResponsiveContainer, { width: "100%", height: 250 },
                                React.createElement(BarChart, { data: weeklyProgressData },
                                    React.createElement(XAxis, { dataKey: "name", stroke: "#64748b", fontSize: 12, tickLine: false, axisLine: false }),
                                    React.createElement(YAxis, { stroke: "#64748b", fontSize: 12, tickLine: false, axisLine: false }),
                                    React.createElement(Tooltip, { wrapperClassName: "!bg-white !border-slate-200 !rounded-lg !shadow-lg", cursor: {fill: 'rgba(241, 245, 249, 0.5)'}}),
                                    React.createElement(Legend, { wrapperStyle:{fontSize: "14px"}}),
                                    React.createElement(Bar, { dataKey: "총 할 일", fill: "#e2e8f0", radius: [4, 4, 0, 0], name: "총 할 일"}),
                                    React.createElement(Bar, { dataKey: "완료된 할 일", fill: "#0ea5e9", radius: [4, 4, 0, 0], name: "완료된 할 일"})
                                )
                            )
                        ),
                        React.createElement("div", { className: "mt-6" },
                            React.createElement("button", {
                                onClick: goToDashboard,
                                className: "w-full flex items-center justify-center gap-2 py-3 bg-slate-200 text-slate-800 rounded-lg shadow-sm hover:bg-slate-300 transition-colors font-semibold"
                            }, React.createElement(ChevronLeftIcon, { className: "h-5 w-5" }), "대시보드로 돌아가기")
                        )
                    )
                )
            );
        };
        // END: components/StatsView.tsx
        
        // START: components/WeeklyDashboard.tsx
        const getEventStatusIcon = (completed) => {
            if (completed) {
                return React.createElement(CheckIcon, { className: "h-3 w-3 text-teal-600" });
            }
            return React.createElement(CircleIcon, { className: "h-2 w-2 text-slate-400" });
        };

        const getStatusIcon = (status) => {
            switch (status) {
                case TaskStatus.Done: return React.createElement(CheckIcon, { className: "h-3 w-3 text-green-600" });
                case TaskStatus.NotDone: return React.createElement(XMarkIcon, { className: "h-3 w-3 text-red-600" });
                case TaskStatus.Migrated: return React.createElement(ArrowRightIcon, { className: "h-3 w-3 text-yellow-600" });
                default: return React.createElement(CircleIcon, { className: "h-2 w-2 text-slate-400" });
            }
        };

        const WeeklyDashboard = () => {
            const { tasks, getSubjectById, dDay, weeklyGoals, motivationalQuotes, updateWeeklyMotivationalQuote, setSelectedDate, toggleWeeklyGoal, getEventsForDate, getStudyTimeForDate } = useContext(PlannerContext);
            const [currentDate, setCurrentDate] = useState(new Date());

            const weekStart = startOfWeek(currentDate, { weekStartsOn: 1 });
            const weekEnd = endOfWeek(currentDate, { weekStartsOn: 1 });
            const days = eachDayOfInterval({ start: weekStart, end: weekEnd });

            const weekStartKey = format(weekStart, 'yyyy-MM-dd');
            const currentWeeklyQuote = motivationalQuotes[weekStartKey] || '';

            const tasksByDate = useMemo(() => {
                const map = new Map();
                days.forEach(day => {
                    const dateStr = format(day, 'yyyy-MM-dd');
                    const dayTasks = tasks.filter(task => task.date === dateStr);
                    map.set(dateStr, dayTasks);
                });
                return map;
            }, [tasks, days]);

            const eventsByDate = useMemo(() => {
                const map = new Map();
                days.forEach(day => {
                    const dateStr = format(day, 'yyyy-MM-dd');
                    const dayEvents = getEventsForDate(dateStr);
                    map.set(dateStr, dayEvents);
                });
                return map;
            }, [getEventsForDate, days]);

            const dDayDiff = useMemo(() => {
                if (!dDay.targetDate) return null;
                const target = parseISO(dDay.targetDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const diffTime = target.getTime() - today.getTime();
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            }, [dDay.targetDate]);
            
            const formatStudyTime = (totalMinutes) => {
                if (!totalMinutes || totalMinutes <= 0) return '';
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                const parts = [];
                if (hours > 0) parts.push(`${hours}시간`);
                if (minutes > 0) parts.push(`${minutes}분`);
                return parts.join(' ');
            };
            
            return (
                React.createElement("div", { className: "flex flex-col h-full" },
                    React.createElement("header", { className: "px-2 pt-2" },
                        React.createElement("div", { className: "flex justify-between items-center mb-2" },
                            React.createElement("h2", { className: "font-bold text-lg text-slate-800" }, format(weekStart, 'yyyy년 M월')),
                            React.createElement("div", { className: "flex items-center" },
                                React.createElement("button", {
                                    onClick: () => setCurrentDate(subDays(currentDate, 7)),
                                    "aria-label": "이전 주",
                                    className: "p-2 rounded-l-md border border-slate-300 bg-white hover:bg-slate-50"
                                }, React.createElement(ChevronLeftIcon, { className: "h-5 w-5 text-slate-600" })),
                                React.createElement("button", {
                                    onClick: () => setCurrentDate(addDays(currentDate, 7)),
                                    "aria-label": "다음 주",
                                    className: "p-2 rounded-r-md border-t border-b border-r border-slate-300 bg-white hover:bg-slate-50"
                                }, React.createElement(ChevronRightIcon, { className: "h-5 w-5 text-slate-600" }))
                            )
                        ),
                        dDay.title && dDayDiff !== null && (
                            React.createElement("div", { className: "bg-gradient-to-r from-sky-500 to-indigo-500 text-white p-4 rounded-lg shadow-md text-center mb-2 space-y-2" },
                                React.createElement("div", null,
                                    React.createElement("p", { className: "font-semibold text-lg" }, dDay.title),
                                    React.createElement("p", { className: "text-3xl font-bold" }, `D-${dDayDiff >= 0 ? dDayDiff : '+' + Math.abs(dDayDiff)}`)
                                ),
                                React.createElement("input", {
                                    type: "text",
                                    value: currentWeeklyQuote,
                                    onChange: (e) => updateWeeklyMotivationalQuote(weekStartKey, e.target.value),
                                    placeholder: "이번 주의 동기 부여 문구를 입력하세요...",
                                    className: "w-full text-center bg-white/20 p-2 rounded-lg text-sm font-medium text-white placeholder:text-white/70 placeholder:font-normal focus:outline-none focus:ring-2 focus:ring-white"
                                })
                            )
                        )
                    ),
                    React.createElement("div", { className: "bg-white p-3 rounded-lg shadow-sm mb-2" },
                        React.createElement("h3", { className: "font-semibold text-slate-700 mb-2 text-sm text-right" }, "이번 주 목표"),
                        React.createElement("div", { className: "space-y-0.5" },
                            (weeklyGoals || []).slice(0, 3).map((goal, index) => (
                                React.createElement("div", { key: goal.id, className: "flex items-center" },
                                    React.createElement("span", { className: "text-sm text-slate-500 ml-auto mr-2" }, `${index + 1}.`),
                                    React.createElement("span", { className: "text-sm text-slate-600 mr-4" }, goal.text),
                                    React.createElement("div", { className: "flex gap-1.5" },
                                        days.map(day => {
                                            const dateStr = format(day, 'yyyy-MM-dd');
                                            return (
                                                React.createElement("button", {
                                                    key: dateStr,
                                                    onClick: () => toggleWeeklyGoal(goal.id, dateStr),
                                                    className: `w-6 h-6 rounded-full border-2 transition-colors flex items-center justify-center text-xs font-semibold ${goal.completed[dateStr] ? 'bg-sky-500 border-sky-500' : 'bg-white border-slate-300 hover:border-sky-400 text-slate-500'}`
                                                },
                                                    goal.completed[dateStr] ? React.createElement(CheckIcon, { className: "w-3.5 h-3.5 text-white" }) : React.createElement("span", null, format(day, 'E', { locale: ko }))
                                                )
                                            );
                                        })
                                    )
                                )
                            ))
                        )
                    ),
                    React.createElement("div", { className: "flex-grow grid grid-cols-7 gap-1" },
                        days.map(day => {
                            const dateStr = format(day, 'yyyy-MM-dd');
                            const dayTasks = tasksByDate.get(dateStr) || [];
                            const dayEvents = eventsByDate.get(dateStr) || [];
                            const studyTimeInMinutes = getStudyTimeForDate(dateStr);
                            const isCurrentDay = isToday(day);
                            const dayOfWeek = getDay(day);

                            let dayBgClass = 'bg-white hover:bg-sky-50';
                            if (dayOfWeek === 6) { dayBgClass = 'bg-sky-50 hover:bg-sky-100'; }
                            else if (dayOfWeek === 0) { dayBgClass = 'bg-red-50 hover:bg-red-100'; }
                            
                            const totalItems = dayTasks.length + dayEvents.length;
                            const maxTasksToShow = 10;
                            const maxEventsToShow = 2;
                            const itemsToShow = maxTasksToShow + maxEventsToShow;

                            return (
                                React.createElement("div", {
                                    key: dateStr,
                                    onClick: () => setSelectedDate(dateStr),
                                    className: `rounded-lg shadow-sm p-2 flex flex-col cursor-pointer transition-colors ${dayBgClass}`
                                },
                                    React.createElement("div", { className: "text-center mb-2" },
                                        React.createElement("p", { className: "text-xs text-slate-500" }, format(day, 'EEE', { locale: ko })),
                                        React.createElement("p", { className: `font-semibold text-lg ${isCurrentDay ? 'text-white bg-sky-600 rounded-full w-7 h-7 flex items-center justify-center mx-auto' : 'text-slate-800'}` }, format(day, 'd'))
                                    ),
                                    React.createElement("div", { className: "space-y-1 overflow-y-auto flex-grow" },
                                        dayTasks.slice(0, maxTasksToShow).map(task => {
                                            const subject = getSubjectById(task.subjectId);
                                            const bgColor = subject ? subject.color.split(' ')[0] : 'bg-slate-100';
                                            return (
                                                React.createElement("div", { key: task.id, className: `flex items-center gap-1.5 p-1 rounded-md text-xs ${bgColor}` },
                                                    getStatusIcon(task.status),
                                                    React.createElement("span", { className: "truncate text-slate-700" }, task.plan)
                                                )
                                            )
                                        }),
                                        dayEvents.slice(0, maxEventsToShow).map(event => (
                                            React.createElement("div", { key: event.id, className: "flex items-center gap-1.5 p-1 rounded-md text-xs bg-teal-100" },
                                                getEventStatusIcon(event.completed),
                                                React.createElement("span", { className: `truncate ${event.completed ? 'text-slate-500 line-through' : 'text-slate-700'}` }, event.text)
                                            )
                                        )),
                                        totalItems > itemsToShow && React.createElement("p", { className: "text-xs text-center text-slate-500 mt-1" }, `+${totalItems - itemsToShow} more`)
                                    ),
                                    studyTimeInMinutes > 0 && (
                                        React.createElement("div", { className: "mt-auto pt-1 flex items-center justify-center text-xs font-bold" },
                                            React.createElement("div", {className: "bg-red-500 text-white rounded px-2 py-0.5 flex items-center gap-1"},
                                                React.createElement(ClockIcon, { className: "h-3 w-3" }),
                                                formatStudyTime(studyTimeInMinutes)
                                            )
                                        )
                                    )
                                )
                            );
                        })
                    )
                )
            );
        };
        // END: components/WeeklyDashboard.tsx
        
        // START: components/Login.tsx
        const Login = () => {
            const handleGoogleLogin = async () => {
                try {
                    await signInWithPopup(auth, googleProvider);
                } catch (error) {
                    console.error("Google 로그인 실패:", error);
                    alert("로그인에 실패했습니다. 다시 시도해주세요.");
                }
            };

            return React.createElement("div", { className: "min-h-screen bg-slate-100 flex flex-col justify-center items-center p-4" },
                React.createElement("div", { className: "w-full max-w-sm text-center" },
                    React.createElement("h1", { className: "text-4xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-sky-600 to-violet-600" }, "Momentum"),
                    React.createElement("p", { className: "mt-2 text-lg text-slate-600" }, "나만의 스마트 학습 라이프 로그"),
                    React.createElement("div", { className: "mt-12 bg-white p-8 rounded-2xl shadow-xl" },
                        React.createElement("h2", { className: "text-xl font-semibold text-slate-800 mb-2" }, "시작하기"),
                        React.createElement("p", { className: "text-slate-500 mb-6" }, "Google 계정으로 로그인하여 데이터를 안전하게 동기화하세요."),
                        React.createElement("button", {
                            onClick: handleGoogleLogin,
                            className: "w-full flex items-center justify-center gap-3 py-3 px-4 bg-white border border-slate-300 rounded-lg shadow-sm hover:shadow-md transition-shadow font-semibold text-slate-700"
                        }, 
                            React.createElement(GoogleIcon, null),
                            "Google 계정으로 로그인"
                        )
                    )
                )
            );
        };
        // END: components/Login.tsx

        // START: App.tsx
        const NavButton = ({ label, icon, isActive, onClick }) => (
            React.createElement("button", {
                onClick: onClick,
                className: `flex flex-col items-center justify-center space-y-1 w-24 h-16 rounded-lg transition-colors duration-200 ${isActive ? 'bg-sky-100 text-sky-700' : 'text-slate-500 hover:bg-slate-100'}`
            },
                icon,
                React.createElement("span", { className: "text-xs font-medium" }, label)
            )
        );

        const App = () => {
            const { user } = useAuth();
            const [activeView, setActiveView] = useState('dashboard');
            const { selectedDate, setSelectedDate } = useContext(PlannerContext);

            if (!user) {
                return React.createElement(Login, null);
            }

            const handleLogout = async () => {
                if (confirm('로그아웃 하시겠습니까?')) {
                    await signOut(auth);
                }
            };

            const goToDashboard = () => setActiveView('dashboard');

            const renderView = () => {
                switch (activeView) {
                    case 'stats': return React.createElement(StatsView, { goToDashboard: goToDashboard });
                    case 'settings': return React.createElement(SettingsView, { goToDashboard: goToDashboard });
                    default: return React.createElement(WeeklyDashboard, null);
                }
            };

            return (
                React.createElement("div", { className: "min-h-screen font-sans flex flex-col max-w-screen-2xl mx-auto" },
                    React.createElement("header", { className: "p-4 border-b border-slate-200 bg-sky-100 sticky top-0 z-20 flex items-center justify-between" },
                        React.createElement("div", { className: "flex items-center gap-2" },
                           user.photoURL && React.createElement("img", { src: user.photoURL, alt: user.displayName, className:"w-8 h-8 rounded-full"}),
                           React.createElement("span", { className: "text-sm font-semibold text-slate-700 hidden sm:block"}, `${user.displayName}님 환영합니다!`)
                        ),
                        React.createElement("div", { className: "text-center absolute left-1/2 -translate-x-1/2" },
                            React.createElement("h1", { className: "text-2xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-sky-600 to-violet-600" }, "Momentum"),
                            React.createElement("p", { className: "text-sm text-slate-600" }, "나만의 스마트 학습 라이프 로그")
                        ),
                        React.createElement("button", { 
                            onClick: handleLogout, 
                            className: "p-2 rounded-full hover:bg-slate-200/80 transition-colors",
                            title: "로그아웃"
                        },
                            React.createElement(LogoutIcon, {className: "text-slate-600"})
                        )
                    ),
                    React.createElement("main", { className: "flex-grow p-2 sm:p-4 bg-slate-100/50" }, renderView()),
                    React.createElement("footer", { className: "text-center p-4 text-xs text-slate-500 bg-slate-100/50" }, "© 2025 KH KIM. All Rights Reserved."),
                    React.createElement("nav", { className: "sticky bottom-0 bg-white border-t border-slate-200 p-2 flex justify-around items-center z-20" },
                        React.createElement(NavButton, { label: "대시보드", icon: React.createElement(HomeIcon, null), isActive: activeView === 'dashboard', onClick: () => setActiveView('dashboard') }),
                        React.createElement(NavButton, { label: "통계", icon: React.createElement(ChartBarIcon, null), isActive: activeView === 'stats', onClick: () => setActiveView('stats') }),
                        React.createElement(NavButton, { label: "설정", icon: React.createElement(CogIcon, null), isActive: activeView === 'settings', onClick: () => setActiveView('settings') })
                    ),
                    React.createElement(DailyDetailView, { isOpen: !!selectedDate, onClose: () => setSelectedDate(null), date: selectedDate })
                )
            );
        };
        // END: App.tsx
        
        // START: index.tsx
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
            React.createElement(React.StrictMode, null,
                React.createElement(AuthProvider, null,
                    React.createElement(PlannerProvider, null,
                        React.createElement(App, null)
                    )
                )
            )
        );
        // END: index.tsx
    </script>
</body>
</html>
